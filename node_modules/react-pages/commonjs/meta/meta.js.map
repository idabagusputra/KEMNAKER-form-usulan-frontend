{"version":3,"file":"meta.js","names":["browserDocument","BrowserDocument","DEFAULT_META","charset","viewport","META_METHOD_NAME","mergeMeta","meta","reduce","componentMeta","locale","locales","filter","_","length","getComponentsMeta","components","state","map","Error","JSON","stringify","dropUndefinedProperties","getCodeSplitMeta","routes","patchMeta","metaProperties","updateMeta","window","_ReactPages_Page_Meta","document","title","normalizeMeta","meta_tags","getMetaTags","getTitle","setTitle","updateMetaTag","new_meta_tags","compact","key","value","forEach","removeMetaTag","addMetaTag","generateMetaTagsMarkup","escapeHTML","concat","generateMetaTagMarkup","name","String","getMetaAttributeFor","getMetaKeyAliases","i","meta_tag","isMetaTag","getMetaTagValue","setMetaTagValue","splice","string","replace","normalizeMetaKeys","Object","keys","all","alias","push","convertMeta","Array","isArray","flatten","keyValue","expandArrays","expandObjects","convertOpenGraphLocaleToLanguageTag","ogLocale"],"sources":["../../lib/meta/meta.js"],"sourcesContent":["// import { flatten, compact } from 'lodash-es'\r\nimport flatten from 'lodash/flatten.js'\r\nimport compact from 'lodash/compact.js'\r\n\r\nimport BrowserDocument, { getMetaAttributeFor } from './BrowserDocument.js'\r\nimport dropUndefinedProperties from './dropUndefinedProperties.js'\r\n\r\nconst browserDocument = new BrowserDocument()\r\n\r\nconst DEFAULT_META = {\r\n\tcharset: 'utf-8',\r\n\t// Fixes CSS screen width on mobile devices.\r\n\t// Otherwise media queries would not be applied initially\r\n\t// and it would show desktop version design.\r\n\t// Also, for `/react-pages-base` page this meta tag\r\n\t// needs to be present in markup as the default one\r\n\t// because `/react-pages-base` page doesn't collect\r\n\t// meta from page components.\r\n\tviewport: 'width=device-width, initial-scale=1.0'\r\n}\r\n\r\nconst META_METHOD_NAME = 'meta'\r\n\r\n/**\r\n * Gathers `<title/>` and `<meta/>` tags (inside `<head/>`)\r\n * defined for this route (`components` array).\r\n * @param {object[]} meta — An array of meta objects.\r\n * @return {object}\r\n */\r\nexport function mergeMeta(meta) {\r\n\t// // `Object.assign` is not supported in Internet Explorer.\r\n\t// return Object.assign({}, DEFAULT_META, ...)\r\n\r\n\tmeta = meta.reduce((meta, componentMeta) => ({\r\n\t\t...meta,\r\n\t\t...componentMeta\r\n\t}),\r\n\t{ ...DEFAULT_META })\r\n\r\n\t// Remove `locale` from `locales`.\r\n\tif (meta.locale && meta.locales) {\r\n\t\tmeta.locales = meta.locales.filter(_ => _ !== meta.locale)\r\n\t\tif (meta.locales.length === 0) {\r\n\t\t\tdelete meta.locales\r\n\t\t}\r\n\t}\r\n\r\n\treturn meta\r\n}\r\n\r\n/**\r\n * Gets `React.Component` chain meta.\r\n * @return {object[]}\r\n */\r\nexport function getComponentsMeta(components, state) {\r\n\treturn components\r\n\t\t// `.filter(_ => _)` here just in case someone forgets to set\r\n\t\t// `codeSplit: true` for routes with `getComponent`.\r\n\t\t.filter(_ => _)\r\n\t\t.map(_ => _[META_METHOD_NAME])\r\n\t\t.filter(_ => _)\r\n\t\t// Validate that each `meta` is a function.\r\n\t\t// This is just because projects using `react-pages@4.x` could use object `meta`s.\r\n\t\t.map((meta) => {\r\n\t\t\tif (typeof meta !== 'function') {\r\n\t\t\t\tthrow new Error(`A page component's \".meta\" must be a function. Received: ${typeof meta}. Meta: ${JSON.stringify(meta)}`)\r\n\t\t\t}\r\n\t\t\treturn meta\r\n\t\t})\r\n\t\t// // Convert objects to functions.\r\n\t\t// .map(_ => typeof _ === 'object' ? () => _ : _)\r\n\t\t.map(_ => _(state))\r\n\t\t.map(dropUndefinedProperties)\r\n}\r\n\r\n/**\r\n * Gathers `meta` from routes chain.\r\n * Meta could have been provided via the standard static `meta` property instead\r\n * but `found` router doesn't provide the actual React Components for routes\r\n * which are resolved through `getComponent` so there's currently no way\r\n * of getting the actual Route component classes, hence the `meta` property workaround.\r\n *\r\n * @return {object[]}\r\n */\r\nexport function getCodeSplitMeta(routes, state) {\r\n\treturn routes\r\n\t\t.map(_ => _.meta)\r\n\t\t.filter(_ => _)\r\n\t\t.map(_ => dropUndefinedProperties(_(state)))\r\n}\r\n\r\n/**\r\n * (advanced) (hacking around)\r\n * This client-side-only function is expored from this library\r\n * as an `updateMeta()` function. It could be used to \"patch\"\r\n * the latest applied `meta` for whatever reason.\r\n *\r\n * For example, one project required this type of function when\r\n * migrating `load()` methods from always being handled by this library\r\n * to being sometimes handled in a React's `useEffect()` hook\r\n * as a possible \"user experience\" enhancement.\r\n *\r\n * Another use case would be somehow changing the page's `title`\r\n * after some additional user-specific data has been loaded in a\r\n * React's `useEffect()` hook.\r\n *\r\n * Or, for example, when `<title/>` gets updated with the count of\r\n * unread notifications.\r\n */\r\nexport function patchMeta(metaProperties) {\r\n\tupdateMeta({\r\n\t\t...window._ReactPages_Page_Meta,\r\n\t\t...metaProperties\r\n\t})\r\n}\r\n\r\n/**\r\n * Updates `<title/>` and `<meta/>` tags (inside `<head/>`).\r\n */\r\nexport function updateMeta(meta, document = browserDocument) {\r\n\t// Keep a reference to the latest applied `meta`\r\n\t// in order for the `patchMeta()` public exported function to work.\r\n\t// The public exported `patchMeta()` function is not the same as\r\n\t// this `updateMeta()` function.\r\n\t//\r\n\t// Tests don't have a `window` global variable.\r\n\tif (typeof window !== 'undefined') {\r\n\t\twindow._ReactPages_Page_Meta = meta\r\n\t}\r\n\r\n\tconst { title, charset } = meta\r\n\tmeta = normalizeMeta(meta)\r\n\r\n\t// Get all `<meta/>` tags.\r\n\t// (will be mutated)\r\n\tconst meta_tags = document.getMetaTags()\r\n\r\n\t// Update `<title/>`.\r\n\tif (title && document.getTitle() !== title) {\r\n\t\tdocument.setTitle(title)\r\n\t}\r\n\r\n\t// Update `<meta charset/>`.\r\n\tif (charset) {\r\n\t\tupdateMetaTag(document, meta_tags, 'charset', charset)\r\n\t}\r\n\r\n\t// Update existing `<meta/>` tags.\r\n\t// (removing them from `meta_tags` array)\r\n\tconst new_meta_tags = compact(\r\n\t\tmeta.map(([key, value]) => {\r\n\t\t\tif (!updateMetaTag(document, meta_tags, key, value)) {\r\n\t\t\t\treturn [key, value]\r\n\t\t\t}\r\n\t\t})\r\n\t)\r\n\r\n\t// Delete no longer existent `<meta/>` tags.\r\n\tmeta_tags.forEach(document.removeMetaTag)\r\n\r\n\t// Create new `<meta/>` tags.\r\n\tfor (const [key, value] of new_meta_tags) {\r\n\t\tdocument.addMetaTag(key, value)\r\n\t}\r\n}\r\n\r\n/**\r\n * Generates a list of `<title/>` and `<meta/>` tags markup.\r\n * @param  {object[]} meta\r\n * @return {string[]}\r\n */\r\nexport function generateMetaTagsMarkup(meta) {\r\n\tconst { title, charset } = meta\r\n\tmeta = normalizeMeta(meta)\r\n\r\n\treturn [\r\n\t\t// `<meta charset/>` should always come first\r\n\t\t// because some browsers only read the first\r\n\t\t// 1024 bytes when deciding on page encoding.\r\n\t\t// (`<meta charset/>` is always present)\r\n\t\t`<meta charset=\"${escapeHTML(charset || DEFAULT_META.charset)}\"/>`,\r\n\t\t`<title>${escapeHTML(title || '')}</title>`\r\n\t]\r\n\t.concat(\r\n\t\tmeta.map(([key, value]) => generateMetaTagMarkup(key, value))\r\n\t)\r\n}\r\n\r\n/**\r\n * Generates `<meta/>` tag HTML markup.\r\n * @param {string} key\r\n * @param {string} value\r\n * @return {string}\r\n */\r\nfunction generateMetaTagMarkup(name, value) {\r\n\tif (typeof value === 'boolean' || typeof value === 'number') {\r\n\t\tvalue = String(value)\r\n\t} else {\r\n\t\tvalue = escapeHTML(String(value))\r\n\t}\r\n\treturn `<meta ${getMetaAttributeFor(name)}=\"${name}\" content=\"${value}\"/>`\r\n}\r\n\r\n/**\r\n * Gets `<meta/>` property aliases.\r\n * (for both `name` and `property`).\r\n * Also filters out `charset`.\r\n * @return {string}\r\n */\r\nfunction getMetaKeyAliases(key) {\r\n\tswitch (key)\r\n\t{\r\n\t\t// `<meta charset/>` is handled specially\r\n\t\t// because it doesn't have `name` attribute.\r\n\t\tcase 'charset':\r\n\t\t\treturn []\r\n\t\t// `<meta name=\"description\"/>` is an older and\r\n\t\t// more widely supported form than \"og:description\".\r\n\t\t// In practice there's no need to duplicate\r\n\t\t// `<meta name=\"description\"/>` as \"og:description\".\r\n\t\t// Still, to keep it fully-OpenGraph-compliant\r\n\t\t// the description is duplicated as \"og:description\" here.\r\n\t\t// https://indieweb.org/The-Open-Graph-protocol#How_to_set_description\r\n\t\tcase 'description':\r\n\t\t\treturn [key, `og:${key}`]\r\n\t\tcase 'siteName':\r\n\t\t\treturn [`og:site_name`]\r\n\t\tcase 'site_name':\r\n\t\t// `title` property of `meta` object is\r\n\t\t// handled specially via a `<title/>` tag.\r\n\t\t// There would be no need to add `og:title`\r\n\t\t// which duplicates the existing `<title/>`,\r\n\t\t// and `title` property could be discarded here.\r\n\t\t// For example, Facebook falls back to `<title/>` tag.\r\n\t\t// Still, OpenGraph specs formally require an `og:title`.\r\n\t\t// So, to keep it fully-OpenGraph-compliant\r\n\t\t// the title is duplicated as \"og:title\" here.\r\n\t\t// https://indieweb.org/The-Open-Graph-protocol#How_to_set_title\r\n\t\tcase 'title':\r\n\t\t// SVG images are not supported (boo).\r\n\t\t// https://indieweb.org/The-Open-Graph-protocol#How_to_set_image\r\n\t\tcase 'image':\r\n\t\tcase 'locale':\r\n\t\tcase 'type':\r\n\t\tcase 'url':\r\n\t\tcase 'audio':\r\n\t\tcase 'video':\r\n\t\t\treturn [`og:${key}`]\r\n\t\tcase 'locales':\r\n\t\t\treturn ['og:locale:alternate']\r\n\t\tdefault:\r\n\t\t\treturn [escapeHTML(key)]\r\n\t}\r\n}\r\n\r\n/**\r\n * Updates `<meta/>` tag to a new `value` and removes it from `meta_tags`.\r\n * @param {Document} document - `BrowserDocument` or `TestDocument`.\r\n * @return {boolean?}\r\n */\r\nfunction updateMetaTag(document, meta_tags, name, value) {\r\n\tlet i = 0\r\n\twhile (i < meta_tags.length) {\r\n\t\tconst meta_tag = meta_tags[i]\r\n\t\tif (document.isMetaTag(meta_tag, name)) {\r\n\t\t\t// Update `<meta/>` tag `value`.\r\n\t\t\tif (document.getMetaTagValue(meta_tag) !== value) {\r\n\t\t\t\tdocument.setMetaTagValue(meta_tag, value)\r\n\t\t\t}\r\n\t\t\t// Remove it from `meta_tags`.\r\n\t\t\tmeta_tags.splice(i, 1)\r\n\t\t\t// Updated.\r\n\t\t\treturn true\r\n\t\t}\r\n\t\ti++\r\n\t}\r\n}\r\n\r\n/**\r\n * Escapes a string so that it's kinda safe to insert into HTML.\r\n * @return {string}\r\n */\r\nfunction escapeHTML(string) {\r\n\treturn string && string\r\n\t\t.replace('&', '&amp;')\r\n\t\t.replace('<', '&lt;')\r\n\t\t.replace('>', '&gt;')\r\n\t\t.replace('\"', '&quot;')\r\n\t\t.replace('\\'', '&#x27;')\r\n\t\t.replace('/', '&#x2F;')\r\n}\r\n\r\n/**\r\n * Transforms meta object having \"keys\"\r\n * into a meta object having the actual\r\n * `<meta/>` tag `name`s and `property`es.\r\n * @return Array of arrays having shape `[key, value]`.\r\n */\r\nfunction normalizeMetaKeys(meta) {\r\n\treturn Object.keys(meta).reduce((all, key) => {\r\n\t\tfor (const alias of getMetaKeyAliases(key)) {\r\n\t\t\tall.push([alias, meta[key]])\r\n\t\t}\r\n\t\treturn all\r\n\t}, [])\r\n}\r\n\r\nfunction normalizeMeta(meta) {\r\n\treturn convertMeta(normalizeMetaKeys(meta))\r\n}\r\n\r\n// Expands nested objects.\r\n// Expands arrays.\r\n// @param meta — Either an object or an array of arrays having shape `[key, value]`.\r\n// @return An array of arrays having shape `[key, value]`.\r\nexport function convertMeta(meta) {\r\n\t// Convert meta object to an array of arrays having shape `[key, value]`.\r\n\tif (!Array.isArray(meta)) {\r\n\t\tmeta = Object.keys(meta).map(key => [key, meta[key]])\r\n\t}\r\n\treturn flatten(\r\n\t\tmeta.map((keyValue) => {\r\n\t\t\treturn flatten(\r\n\t\t\t\texpandArrays(keyValue)\r\n\t\t\t\t\t.map(expandObjects)\r\n\t\t\t)\r\n\t\t})\r\n\t)\r\n}\r\n\r\n// There can be arrays of properties.\r\n// For example:\r\n// <meta property=\"og:image\" content=\"//example.com/image.jpg\" />\r\n// <meta property=\"og:image:width\" content=\"100\" />\r\n// <meta property=\"og:image:height\" content=\"100\" />\r\n// <meta property=\"og:image\" content=\"//example.com/image@2x.jpg\" />\r\n// <meta property=\"og:image:width\" content=\"200\" />\r\n// <meta property=\"og:image:height\" content=\"200\" />\r\nexport function expandArrays(meta) {\r\n\tif (Array.isArray(meta[1])) {\r\n\t\treturn meta[1].map(value => [meta[0], value])\r\n\t}\r\n\treturn [meta]\r\n}\r\n\r\n// If `value` is an object\r\n// then expand such object\r\n// prefixing property names.\r\nexport function expandObjects(meta) {\r\n\tif (typeof meta[1] === 'object') {\r\n\t\treturn flatten(\r\n\t\t\tObject.keys(meta[1])\r\n\t\t\t\t.map((key) => [\r\n\t\t\t\t\tkey === '_' ? meta[0] : `${meta[0]}:${key}`,\r\n\t\t\t\t\tmeta[1][key]\r\n\t\t\t\t])\r\n\t\t\t\t// Expand objects recursively.\r\n\t\t\t\t.map(expandObjects)\r\n\t\t)\r\n\t}\r\n\treturn [meta]\r\n}\r\n\r\nexport function convertOpenGraphLocaleToLanguageTag(ogLocale) {\r\n\treturn ogLocale.replace('_', '-')\r\n}"],"mappings":"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"}